<!doctype html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Todo一覧</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.css}" />
    <link rel="stylesheet" th:href="@{/css/todos.css}" />
  </head>
  <body>
    <div class="container py-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3 m-0">Todo一覧</h1>
        <a class="btn btn-primary" th:href="@{/todos/new}">新規作成</a>
      </div>

      <div
        th:if="${message}"
        class="alert alert-success"
        role="alert"
        th:text="${message}"
      ></div>

      <div class="table-responsive">
        <table class="table align-middle">
          <thead class="table-light">
            <tr>
              <th style="width: 60%">タイトル / 詳細</th>
              <th style="width: 20%">期限日</th>
              <th style="width: 20%">操作</th>
            </tr>
          </thead>
          <tbody>
            <tr
              th:each="todo : ${todos}"
              th:classappend="${todo.completed} ? 'table-secondary'"
            >
              <td>
                <div class="d-flex align-items-center gap-2">
                  <button
                    class="btn btn-sm btn-outline-primary"
                    th:id="'toggle-' + ${todo.publicId.value}"
                    type="button"
                    data-toggle="detail"
                    th:data-target="'detail-' + ${todo.publicId.value}"
                  >
                    + 詳細
                  </button>
                  <span th:text="${todo.title}"></span>
                </div>
                <div
                  class="mt-2 d-none"
                  th:id="'detail-' + ${todo.publicId.value}"
                >
                  <div class="text-muted" th:text="${todo.detail}"></div>
                </div>
              </td>
              <td>
                <span
                  class="text-body"
                  th:text="${#temporals.format(todo.dueDate.value, 'yyyy-MM-dd')}"
                ></span>
              </td>
              <td>
                <div class="d-flex gap-2 justify-content-end">
                  <a
                    class="btn btn-sm btn-outline-secondary"
                    th:href="@{'/todos/' + ${todo.publicId.value} + '/edit'}"
                    th:if="${!todo.completed}"
                    >編集</a
                  >
                  <form
                    th:action="@{'/todos/' + ${todo.publicId.value} + '/complete'}"
                    method="post"
                    class="m-0"
                    onsubmit="return confirm('完了しますか？');"
                    th:if="${!todo.completed}"
                  >
                    <button type="submit" class="btn btn-sm btn-success">
                      完了
                    </button>
                  </form>
                  <form
                    th:action="@{'/todos/' + ${todo.publicId.value} + '/delete'}"
                    method="post"
                    class="m-0"
                    onsubmit="return confirm('削除しますか？');"
                  >
                    <button type="submit" class="btn btn-sm btn-danger">
                      削除
                    </button>
                  </form>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <script th:src="@{/js/bootstrap.bundle.js}"></script>
    <script th:src="@{/js/todos-list.js}"></script>
  </body>
</html>
